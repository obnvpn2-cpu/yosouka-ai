#!/bin/bash
# レース詳細取得 - 30分インターバル付き自動実行スクリプト

echo "=========================================="
echo "レース詳細取得 自動実行開始"
echo "100件ごとに30分のインターバルを挟みます"
echo "=========================================="

# 初期進捗確認
python check_race_progress.py

# 10回ループ（合計1000件、997件をカバー）
for i in {1..10}; do
  echo ""
  echo "=========================================="
  echo "バッチ $i/10 実行中..."
  echo "開始時刻: $(date '+%Y-%m-%d %H:%M:%S')"
  echo "=========================================="
  
  # 100件処理
  python batch_race_detail.py --limit 100
  
  # 進捗確認
  echo ""
  echo "=========================================="
  echo "現在の進捗:"
  echo "=========================================="
  python check_race_progress.py
  
  # 最後のバッチ以外は30分待機
  if [ $i -lt 10 ]; then
    echo ""
    echo "=========================================="
    echo "30分間のインターバル開始"
    echo "次回実行予定: $(date '+%Y-%m-%d %H:%M:%S' -d '+30 minutes' 2>/dev/null || echo '30分後')"
    echo "=========================================="
    
    # 30分 = 1800秒
    sleep 1800
  fi
done

echo ""
echo "=========================================="
echo " 全バッチ処理完了！"
echo "完了時刻: $(date '+%Y-%m-%d %H:%M:%S')"
echo "=========================================="

# 最終進捗確認
python check_race_progress.py --verbose

echo ""
echo "詳細はログファイルを確認してください:"
echo "logs/batch_race_detail_*.log"
